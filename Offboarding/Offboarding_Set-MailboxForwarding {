function Set-MailboxForwarding {
    [CmdletBinding()]
    Param (
        [Parameter(Mandatory)]
        [string]$accessToken,
        [Parameter(Mandatory)]
        [string]$userPrincipalName,
        [Parameter(Mandatory)]
        [string]$ForwardingAddress,
        [Parameter()]
        [string]$ForwardingName,
        [Parameter()]
        [string]$RuleName = 'Automation - Offboarding Forwarding'
    )
    begin {
        $headers = @{
            Authorization = "Bearer $($Token.access_token)"
        }

        $apiUrl = "https://graph.microsoft.com/v1.0/users/brad@thelazyadministrator.com/mailFolders/inbox/messageRules"
    }
    process {
        #Search for our user in Azure AD. If you dont care to have your user be an internal user, you can skip this part and remove it
        $FwdUser = Searchfor-User -UPN $ForwardingAddress -AccessToken $token.access_token
        #if we found our fwding user
        if ($FwdUser) {
            $ForwardingName = $FwdUser.displayName
            $ForwardingAddress = $FwdUser.mail

            $params = @{
                DisplayName = $RuleName
                Sequence = 1
                IsEnabled = $true
                Actions = @{
                    ForwardTo = @(
                        @{
                            EmailAddress = @{
                                Name = $ForwardingName
                                Address = $ForwardingAddress
                            }
                        }
                    )
                    StopProcessingRules = $true
                }
            }
            $body = $params | ConvertTo-Json -Depth 10
    
            $mailboxForwarding = Invoke-RestMethod -Uri $apiURL -Headers $headers -Method POST -Body $body -ContentType "application/json" 
        }
    }
    end {
        return $mailboxForwarding
    }
}